# 补偿模型范围分析报告

## 1. 问题描述

当前补偿模型的 y_range（真实值范围）与设备的实际测量范围存在差异：

| 项目 | 范围 |
|------|------|
| **设备实际范围** | 0 ~ 43 mm |
| **模型覆盖范围** | 0.9998 ~ 41.9978 mm |
| **低端缺失** | 0 ~ 0.9998 mm（约 **1.0 mm**） |
| **高端缺失** | 41.9978 ~ 43 mm（约 **1.0 mm**） |

---

## 2. 模型详情分析

### 2.1 当前模型参数

```json
{
  "model_type": "cubic_spline",
  "calibration_points": 42,
  "x_range": [-24.0956, 17.5476],  // 测量值范围
  "y_range": [0.9998, 41.9978]     // 真实值范围
}
```

### 2.2 范围覆盖率

```
设备满量程: 43 mm
模型覆盖: 41.0 mm (41.9978 - 0.9998)
覆盖率: 95.3%

缺失范围:
├─ 低端 0 ~ 1mm (未标定)
└─ 高端 42 ~ 43mm (未标定)
```

---

## 3. 潜在影响

### 3.1 范围内数据（0.9998 ~ 41.9978 mm）

✅ **正常工作**
- 补偿模型可以正确应用
- 精度有保证

### 3.2 范围外数据

⚠️ **可能出现问题**

| 数据位置 | 当前处理方式 | 潜在风险 |
|----------|-------------|---------|
| < 0.9998 mm | 外推或保持原值 | 精度下降 |
| > 41.9978 mm | 外推或保持原值 | 精度下降 |

### 3.3 外推风险示意

```
                    有效范围
           ←─────────────────────→
    ───────┬───────────────────────┬───────
    外推区 │      精确补偿区       │ 外推区
   (风险)  │      (准确)          │ (风险)
    ───────┴───────────────────────┴───────
          1mm                    42mm
           ↑                       ↑
         起点                    终点
```

---

## 4. 建议方案

### 方案一：扩展标定范围（推荐）

**最佳方案**：重新采集包含 0mm 和 43mm 位置的标定数据

```
原标定范围: 1mm ~ 42mm (42个点)
新标定范围: 0mm ~ 43mm (44个点)

新增标定点:
- 位置 0mm (或接近0的最小位置)
- 位置 43mm (或接近43的最大位置)
```

**优点**：
- 完全覆盖设备量程
- 精度最高
- 无外推风险

### 方案二：线性外推

如果无法重新标定，可以对边界进行线性外推：

```python
# 低端外推（使用前两个标定点的斜率）
if measured < model_min:
    # 使用模型边界的切线进行外推
    compensated = linear_extrapolate(measured, 'low')

# 高端外推（使用后两个标定点的斜率）
if measured > model_max:
    compensated = linear_extrapolate(measured, 'high')
```

**优点**：无需重新标定
**缺点**：外推区域精度降低

### 方案三：边界截断

将超出范围的值截断到边界：

```python
measured_clamped = np.clip(measured, model_min, model_max)
compensated = apply_compensation(measured_clamped, model)
```

**优点**：简单实现
**缺点**：边界附近测量值会失真

---

## 5. 具体建议

### 5.1 如果您可以重新标定

**强烈推荐方案一**

1. 在现有标定数据基础上，增加两个位置的标定：
   - **0mm 位置**（或设备允许的最小位置）
   - **43mm 位置**（或设备允许的最大位置）

2. 重新运行标定流程生成新模型

### 5.2 如果无法重新标定

检查您的实际使用场景：

| 使用场景 | 建议 |
|----------|------|
| 测量范围主要在 1-42mm | 当前模型可用，影响不大 |
| 经常测量 0-1mm 或 42-43mm | 需要扩展标定 |
| 对边界精度要求高 | 必须扩展标定 |

### 5.3 评估当前影响

您可以评估一下：
- 在实际应用中，测量值落在 0-1mm 或 42-43mm 范围的频率有多高？
- 如果很少，当前模型已经足够使用
- 如果频繁，建议扩展标定范围

---

## 6. 总结

| 问题 | 说明 |
|------|------|
| **问题本质** | 标定范围未完全覆盖设备量程 |
| **缺失范围** | 低端约1mm + 高端约1mm |
| **覆盖率** | 95.3% |
| **最佳解决方案** | 增加0mm和43mm位置的标定数据 |
| **临时方案** | 线性外推或边界截断 |

### 决策建议

```
如果可以重新标定 → 方案一（扩展标定范围）
如果边界使用频率低 → 当前模型可用
如果边界使用频率高且无法重新标定 → 方案二（线性外推）
```

---

## 7. 标定点分布可视化

```
真实值(mm)
43 ┤                                              ╱ ← 缺失
42 ┤                                           ●─╯
41 ┤                                        ●
40 ┤                                     ●
39 ┤                                  ●
   │                               ...
   │         (42个标定点)
   │                               ...
 3 ┤     ●
 2 ┤  ●
 1 ┤●─╮
 0 ┤   ╲ ← 缺失
   └────┴────┴────┴────┴────┴────┴────┴────→ 测量值(mm)
       -24   -18   -12   -6    0    6    12   18
```

---

*报告生成时间：2025年12月18日*

