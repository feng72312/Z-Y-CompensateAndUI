# 深度图补偿前后颜色差异分析报告

## 1. 问题描述

补偿前后的两张深度图在视觉上呈现明显的颜色差异：
- **补偿前（before.png）**：颜色较深（深灰色）
- **补偿后（after.png）**：颜色较浅（浅灰色）

---

## 2. 数据分析

### 2.1 灰度值统计（16位: 0-65535）

| 指标 | 补偿前 | 补偿后 | 变化 |
|------|--------|--------|------|
| **平均值** | 26756.20 | 42537.63 | **+15781.43** |
| **最小值** | 22923 | 38706 | +15783 |
| **最大值** | 30487 | 46245 | +15758 |
| **标准差** | 2755.89 | 2746.24 | **-9.65** ✅ |

### 2.2 深度值统计（毫米）

| 指标 | 补偿前 | 补偿后 | 变化 |
|------|--------|--------|------|
| **平均深度** | -9.6189 mm | +15.6314 mm | **+25.2503 mm** |
| **最小深度** | -15.7520 mm | +9.5008 mm | +25.2528 mm |
| **最大深度** | -3.6496 mm | +21.5632 mm | +25.2128 mm |

---

## 3. 原因分析

### 3.1 补偿模型的作用

补偿模型的核心功能是将**测量值**修正为**真实值**：

```
补偿前：测量深度 = -9.62 mm（灰度值较低 → 颜色深）
        ↓
   补偿模型修正（约 +25mm 偏移校正）
        ↓
补偿后：真实深度 = +15.63 mm（灰度值较高 → 颜色浅）
```

### 3.2 灰度值与深度的关系

在16位深度图中，灰度值与深度的转换公式为：

```
灰度值 = OFFSET + (深度mm × 1000 / SCALE_FACTOR)

其中：
- OFFSET = 32768（中心偏移量）
- SCALE_FACTOR = 1.6（缩放因子）
```

**灰度值增加 15781** 对应 **深度增加约 25.25 mm**

### 3.3 颜色变化的本质

| 补偿前 | 补偿后 |
|--------|--------|
| 灰度值 ≈ 26756 | 灰度值 ≈ 42538 |
| 深色区域（< 32768） | 浅色区域（> 32768） |
| 测量值存在系统偏差 | 修正后的真实值 |

---

## 4. 对精度的影响

### 4.1 精度评估指标

| 评估项 | 补偿前 | 补偿后 | 结论 |
|--------|--------|--------|------|
| **动态范围** | 7564 | 7539 | 基本不变 ✅ |
| **标准差** | 2755.89 | 2746.24 | 减小 9.65 ✅ |
| **数据分布** | 正常 | 正常 | 无失真 ✅ |

### 4.2 结论

**✅ 颜色差异对精度没有负面影响！**

1. **标准差减小**：说明补偿后数据更加集中，测量误差减少
2. **动态范围不变**：深度分辨率没有损失
3. **整体偏移**：只是深度值的系统性修正，不是数据失真

---

## 5. 总结

### 问题解答

| 问题 | 答案 |
|------|------|
| 为什么颜色变浅？ | 补偿模型将深度值向上修正了约25mm，灰度值增加 |
| 影响精度吗？ | **不影响**！标准差反而略微减小 |
| 是否正常？ | **完全正常**，这是补偿模型的正常工作 |

### 核心要点

```
颜色深浅的变化是【正常现象】，不影响精度！

原因：补偿模型修正了深度值的系统性偏差（bias），
将测量值映射到了不同的灰度区间，导致视觉上颜色变浅。

关键是看补偿后的线性度是否改善，而不是看颜色深浅！
```

### 类比说明

就像调整相机的白平衡：
- 调整前：照片偏蓝（色温偏冷）
- 调整后：照片偏暖（色温正常）
- **不影响照片的清晰度和细节**

深度图补偿也是类似的原理，只是修正了深度值的"零点偏移"。

---

## 6. 相关文件

| 文件 | 说明 |
|------|------|
| `before.png` | 补偿前的深度图 |
| `after.png` | 补偿后的深度图 |
| `analyze_color_difference.py` | 分析脚本 |
| `color_difference_report.txt` | 简要文本报告 |
| `颜色差异分析报告.md` | 本报告（详细Markdown格式） |

---

*报告生成时间：2025年12月18日*

