# 深度图补偿系统 (Depth Map Compensation System)

> 深度图补偿与UI工具 - 用于校正深度相机的非线性测量误差

## 📊 系统效果

| 指标 | 补偿前 | 补偿后 | 改善 |
|------|--------|--------|------|
| **线性度** | 0.44% | 0.017% | **96%↑** |
| **最大偏差** | 0.19mm | 0.007mm | **96%↑** |

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install numpy scipy opencv-python pillow matplotlib
```

### 2. 启动 UI

```bash
cd ui
python app.py
```

或双击运行 `ui/run.bat`

## 📁 项目结构

```
├── compcodeultimate/          # 核心算法模块
│   ├── calibrator.py          # 图像标定（滤波、平面拟合）
│   ├── compensator.py         # 补偿模型（构建、保存、加载、应用）
│   ├── linearity_calc.py      # 线性度计算
│   ├── config.py              # 配置参数
│   └── utils.py               # 工具函数
├── ui/                        # 图形界面
│   └── app.py                 # Tkinter GUI 应用
├── report/                    # 分析报告
├── sonmereport/               # 详细技术报告
└── compensation_model*.json   # 示例补偿模型
```

## 🔧 核心功能

### 1. 完整标定流程
- 读取标定图像序列
- 应用滤波（3σ去异常值、中值滤波、高斯滤波）
- 平面拟合提取深度值
- 构建三次样条补偿模型

### 2. 图像补偿
- 加载已有补偿模型
- 批量/单张图像补偿
- 支持线性外推（超出模型范围）

### 3. 线性度评估
- BFSL（最佳拟合直线）方法
- 标准差、最大偏差、RMS误差计算

## 📐 补偿模型格式

```json
{
  "model_type": "cubic_spline",
  "version": "2.2",
  "knots": [46个节点],
  "coefficients": [46个系数],
  "k": 3,
  "x_range": [-24.10, 17.55],
  "y_range": [1.00, 42.00],
  "calibration_points": 42
}
```

## 📈 补偿方法对比

| 方法 | 参数量 | 存储大小 | 线性度 | 推荐场景 |
|------|--------|----------|--------|----------|
| 三次样条 | ~93 | ~1.5KB | 0.0019% | PC高精度 |
| 3阶多项式 | 4 | ~100B | 中等 | 嵌入式 |
| 查找表+插值 | ~44 | ~800B | 高 | 实时处理 |

## 🛠️ UI 参数说明

| 参数 | 默认值 | 说明 |
|------|--------|------|
| 满量程 | 43.0mm | 设备测量范围 |
| 异常值阈值 | 3.0σ | 去除离群点 |
| 中值滤波窗口 | 3 | 消除椒盐噪声 |
| 外推距离限制 | 2.0mm | 超出模型范围的最大外推距离 |

## 📝 License

MIT License

## 👤 Author

[@feng72312](https://github.com/feng72312)

