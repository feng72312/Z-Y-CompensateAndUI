# 图形用户界面

## 概述

图形用户界面提供深度补偿系统的可视化操作界面，包含完整流程、补偿模式、线性度计算、重复精度计算四个功能标签页。

## Requirements

### Requirement: 完整流程标签页

系统应当提供完整的标定和测试流程界面。

#### Scenario: 配置输入路径
- **WHEN** 用户点击浏览按钮
- **THEN** 显示目录选择对话框
- **AND** 可选择标定目录、测试目录、输出目录

#### Scenario: 配置参数设置
- **WHEN** 用户需要调整参数
- **THEN** 可设置满量程、异常值阈值、中值滤波窗口
- **AND** 可设置深度转换偏移量和缩放因子
- **AND** 可设置是否启用滤波

#### Scenario: 配置ROI设置
- **WHEN** 用户需要限制分析区域
- **THEN** 可选择全部图像或X方向或Y方向或自定义ROI
- **AND** 可设置起始和结束坐标

#### Scenario: 运行标定流程
- **WHEN** 用户点击开始标定
- **THEN** 在后台线程执行处理标定数据
- **AND** 建立补偿模型
- **AND** 处理测试数据
- **AND** 计算线性度
- **AND** 实时显示日志
- **AND** 完成后显示结果指标

#### Scenario: 显示补偿结果
- **WHEN** 完整流程执行完成
- **THEN** 显示补偿前线性度（%）
- **AND** 显示补偿后线性度（%）
- **AND** 显示补偿前最大偏差（mm）
- **AND** 显示补偿后最大偏差（mm）
- **AND** 显示补偿前RMS误差（mm）
- **AND** 显示补偿后RMS误差（mm）
- **AND** 显示补偿前图像平面标准差均值（mm）
- **AND** 显示补偿后图像平面标准差均值（mm）
- **AND** 显示改善幅度（%）
- **AND** 显示R²决定系数

### Requirement: 补偿模式标签页

系统应当提供模型加载和批量补偿功能。

#### Scenario: 加载补偿模型
- **WHEN** 用户选择JSON模型文件
- **AND** 点击加载模型
- **THEN** 加载模型并显示模型信息
- **AND** 模型状态更新为已加载

#### Scenario: 批量补偿处理
- **WHEN** 模型已加载
- **AND** 用户指定输入输出目录
- **AND** 点击批量补偿
- **THEN** 处理输入目录下所有PNG文件
- **AND** 保存补偿后图像到输出目录
- **AND** 显示处理进度和统计

#### Scenario: 单个补偿处理
- **WHEN** 模型已加载
- **AND** 用户选择单个PNG文件
- **AND** 点击单个补偿
- **THEN** 补偿该图像并保存

#### Scenario: 配置外推参数
- **WHEN** 用户需要处理超范围值
- **THEN** 可设置是否启用外推
- **AND** 可设置低端高端最大外推距离
- **AND** 可设置输出值范围限制

### Requirement: 线性度计算标签页

系统应当提供独立的线性度计算功能。

#### Scenario: 选择测试数据
- **WHEN** 用户指定测试目录
- **THEN** 系统读取目录中的PNG和CSV文件

#### Scenario: 可选模型补偿
- **WHEN** 用户勾选使用补偿模型
- **THEN** 同时计算补偿前后的线性度

#### Scenario: 配置深度转换
- **WHEN** 用户需要自定义深度转换
- **THEN** 可设置偏移量和缩放因子

#### Scenario: 运行计算显示结果
- **WHEN** 用户点击计算线性度
- **THEN** 处理所有图像
- **AND** 显示线性度结果
- **AND** 可选保存报告文件

### Requirement: 重复精度标签页

系统应当提供重复精度测量功能。

#### Scenario: 选择图像目录
- **WHEN** 用户指定包含多张同位置深度图的目录
- **THEN** 系统识别所有PNG文件

#### Scenario: 选择计算模式
- **WHEN** 用户需要选择分析方式
- **THEN** 可选择区域平均值模式或逐像素分析模式

#### Scenario: 配置参数运行
- **WHEN** 用户配置滤波和深度转换参数
- **AND** 点击计算重复精度
- **AND** 目录中至少有2张图像
- **THEN** 计算重复精度指标
- **AND** 显示平均深度、1σ、±3σ、6σ、极差

### Requirement: 界面交互

系统应当提供良好的用户交互体验。

#### Scenario: 异步执行
- **WHEN** 执行耗时操作
- **THEN** 在后台线程执行
- **AND** 界面保持响应
- **AND** 显示进度指示

#### Scenario: 日志显示
- **WHEN** 执行操作
- **THEN** 实时显示操作日志
- **AND** 使用颜色区分信息类型

#### Scenario: 错误处理
- **WHEN** 发生错误
- **THEN** 显示错误对话框
- **AND** 在日志中记录详细信息

## 技术说明

### 界面框架
- 使用Tkinter实现跨平台GUI
- ttk组件提供现代化外观
- 多线程避免界面冻结

### 窗口布局
- 固定大小：1100×800像素
- 四个标签页的选项卡式布局
- 左侧配置、右侧结果的分栏布局

### 完整流程补偿结果参数说明

| 参数 | 单位 | 说明 |
|------|------|------|
| 补偿前/后线性度 | % | BFSL方法计算的线性度，最大偏差/满量程×100% |
| 补偿前/后最大偏差 | mm | 测量值与最佳拟合直线的最大绝对偏差 |
| 补偿前/后RMS误差 | mm | 偏差的均方根值，反映整体偏离程度 |
| 补偿前/后平面标准差均值 | mm | 每张图像平面内像素标准差的平均值，反映图像平整度/噪声 |
| 改善幅度 | % | (补偿前线性度-补偿后线性度)/补偿前线性度×100% |
| R²决定系数 | - | 拟合优度，越接近1表示拟合越好 |

### 批量补偿结果参数说明

| 参数 | 说明 |
|------|------|
| 总像素 | 深度图总像素数 |
| 有效像素 | 非无效值(≠65535)的像素数 |
| 补偿像素 | 在模型范围内成功补偿的像素数 |
| 外推像素 | 使用线性外推处理的像素数 |
| 补偿率 | 补偿像素/有效像素×100% |

### 相关文件
- `ui/app.py` - 主界面实现
- `ui/run.bat` / `ui/run.ps1` - 启动脚本
